<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>MediSafe Backend Auth Test</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<style>
		body { background: #f8f9fa; }
		.response-box { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 12px; min-height: 80px; }
		.small-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; }
	</style>
</head>
<body>
	<div class="container py-4">
		<h1 class="mb-3">MediSafe Backend Auth Test</h1>

		<div class="mb-3">
			<label class="form-label">API Base URL</label>
			<div class="input-group">
				<input id="api-base" type="text" class="form-control" value="http://localhost:4000/api/v1">
				<button id="btn-health" class="btn btn-outline-primary">Health</button>
			</div>
		</div>

		<div class="row g-3 mb-3">
			<div class="col-md-6">
				<div class="card">
					<div class="card-header">Registro</div>
					<div class="card-body">
						<form id="register-form">
							<input type="text" id="reg-username" class="form-control mb-2" placeholder="Usuario" required>
							<input type="password" id="reg-password" class="form-control mb-2" placeholder="Contraseña (min 6)" required>
							<input type="email" id="reg-email" class="form-control mb-2" placeholder="Email (opcional)">
							<button type="submit" class="btn btn-success w-100">Registrar</button>
						</form>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="card">
					<div class="card-header">Login</div>
					<div class="card-body">
						<form id="login-form">
							<input type="text" id="login-username" class="form-control mb-2" placeholder="Usuario" required>
							<input type="password" id="login-password" class="form-control mb-2" placeholder="Contraseña" required>
							<button type="submit" class="btn btn-primary w-100">Iniciar Sesión</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<div class="mb-3">
			<label class="form-label">Token actual</label>
			<div id="token-box" class="response-box small-mono">(sin token)</div>
		</div>

		<div class="mb-3">
			<label class="form-label">Respuesta</label>
			<div id="resp-box" class="response-box small-mono">(sin respuesta)</div>
		</div>
	</div>

	<script>
		let token = '';
		const $ = (id) => document.getElementById(id);
		const show = (el, data) => { el.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2); };
		const apiBase = () => $("api-base").value.replace(/\/$/, '');

		$("btn-health").addEventListener('click', async () => {
			try {
				const res = await fetch(apiBase() + '/health');
				const data = await res.json();
				show($("resp-box"), data);
			} catch (e) {
				show($("resp-box"), 'Error health: ' + e.message);
			}
		});

		$("register-form").addEventListener('submit', async (e) => {
			e.preventDefault();
			const body = {
				username: $("reg-username").value.trim(),
				password: $("reg-password").value,
				email: $("reg-email").value.trim() || null
			};
			try {
				const res = await fetch(apiBase() + '/auth/register', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(body)
				});
				const data = await res.json();
				show($("resp-box"), data);
				if (data && data.token) {
					token = data.token;
					show($("token-box"), token);
				}
			} catch (e) {
				show($("resp-box"), 'Error registro: ' + e.message);
			}
		});

		$("login-form").addEventListener('submit', async (e) => {
			e.preventDefault();
			const body = {
				username: $("login-username").value.trim(),
				password: $("login-password").value
			};
			try {
				const res = await fetch(apiBase() + '/auth/login', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(body)
				});
				const data = await res.json();
				show($("resp-box"), data);
				if (data && data.token) {
					token = data.token;
					show($("token-box"), token);
				}
			} catch (e) {
				show($("resp-box"), 'Error login: ' + e.message);
			}
		});
	</script>
</body>
</html> 
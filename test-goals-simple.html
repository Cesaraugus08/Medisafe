<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Metas Simple - MediSafe</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container py-4">
    <h1 class="text-center mb-4">
      <i class="bi bi-target me-2"></i>Test Metas Simple - MediSafe
    </h1>
    
    <!-- Botones de prueba -->
    <div class="row mb-4">
      <div class="col-md-6">
        <button id="test-add-goal" class="btn btn-success btn-lg w-100 mb-3">
          <i class="bi bi-plus-circle me-2"></i>Agregar Meta de Prueba
        </button>
      </div>
      <div class="col-md-6">
        <button id="test-load-goals" class="btn btn-info btn-lg w-100 mb-3">
          <i class="bi bi-list me-2"></i>Cargar Metas
        </button>
      </div>
    </div>
    
    <!-- Resultados -->
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-target me-2"></i>Metas Guardadas</h5>
      </div>
      <div class="card-body">
        <div id="goals-list">
          <p class="text-muted text-center">Haz clic en "Cargar Metas" para ver las metas guardadas</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Funciones básicas de metas
    function getGoals() {
      return JSON.parse(localStorage.getItem('goals') || '[]');
    }
    
    function saveGoals(goals) {
      localStorage.setItem('goals', JSON.stringify(goals));
    }
    
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
      notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
      
      notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
      }, 3000);
    }
    
    // Función para cargar la lista de metas
    function loadGoalsList() {
      const goalsList = document.getElementById('goals-list');
      const goals = getGoals();
      
      console.log('🎯 Cargando metas:', goals);
      
      if (goals.length === 0) {
        goalsList.innerHTML = `
          <div class="text-center text-muted">
            <i class="bi bi-target" style="font-size: 3rem; opacity: 0.5;"></i>
            <h6 class="mt-2">No tienes metas creadas</h6>
            <p>Haz clic en "Agregar Meta de Prueba" para crear una meta</p>
          </div>
        `;
        return;
      }
      
      let html = '';
      goals.forEach((goal, index) => {
        const status = goal.completed ? 'Completada' : 'Pendiente';
        const statusClass = goal.completed ? 'success' : 'warning';
        
        html += `
          <div class="goal-item ${goal.completed ? 'completed' : ''}">
            <div class="goal-header">
              <div class="goal-title">${goal.title}</div>
              <span class="goal-status ${statusClass}">${status}</span>
            </div>
            ${goal.description ? `<div class="goal-description">${goal.description}</div>` : ''}
            <div class="goal-meta">
              <div class="goal-deadline">
                <i class="bi bi-calendar-event"></i>
                ${goal.deadline ? `Fecha límite: ${goal.deadline}` : 'Sin fecha límite'}
              </div>
              <div>
                <i class="bi bi-clock"></i>
                Creada: ${new Date(goal.createdAt).toLocaleDateString('es-ES')}
              </div>
            </div>
            <div class="goal-actions">
              <button class="btn btn-sm btn-success" onclick="toggleGoalCompletion('${goal.id}')">
                <i class="bi bi-check-circle me-1"></i>
                ${goal.completed ? 'Desmarcar' : 'Completar'}
              </button>
              <button class="btn btn-sm btn-danger" onclick="deleteGoal('${goal.id}')">
                <i class="bi bi-trash me-1"></i>
                Eliminar
              </button>
            </div>
          </div>
        `;
      });
      
      goalsList.innerHTML = html;
    }
    
    // Función para alternar el estado de completado de una meta
    function toggleGoalCompletion(goalId) {
      const goals = getGoals();
      const goalIndex = goals.findIndex(g => g.id === goalId);
      
      if (goalIndex === -1) {
        showNotification('Meta no encontrada', 'error');
        return;
      }
      
      goals[goalIndex].completed = !goals[goalIndex].completed;
      
      if (goals[goalIndex].completed) {
        goals[goalIndex].completedAt = new Date().toISOString();
      } else {
        delete goals[goalIndex].completedAt;
      }
      
      saveGoals(goals);
      loadGoalsList();
      
      const status = goals[goalIndex].completed ? 'completada' : 'marcada como pendiente';
      showNotification(`Meta "${goals[goalIndex].title}" ${status}`, 'success');
    }
    
    // Función para eliminar una meta
    function deleteGoal(goalId) {
      const goals = getGoals();
      const goalIndex = goals.findIndex(g => g.id === goalId);
      
      if (goalIndex === -1) {
        showNotification('Meta no encontrada', 'error');
        return;
      }
      
      const goalTitle = goals[goalIndex].title;
      
      if (confirm(`¿Estás seguro de que quieres eliminar la meta "${goalTitle}"?`)) {
        goals.splice(goalIndex, 1);
        saveGoals(goals);
        loadGoalsList();
        showNotification(`Meta "${goalTitle}" eliminada`, 'success');
      }
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Botón para agregar meta de prueba
      document.getElementById('test-add-goal').addEventListener('click', function() {
        const testGoal = {
          id: Date.now().toString(),
          title: 'Meta de Prueba ' + (getGoals().length + 1),
          description: 'Esta es una meta de prueba creada automáticamente',
          deadline: '2024-12-31',
          completed: false,
          createdAt: new Date().toISOString()
        };
        
        const goals = getGoals();
        goals.push(testGoal);
        saveGoals(goals);
        
        loadGoalsList();
        showNotification('Meta de prueba agregada exitosamente', 'success');
      });
      
      // Botón para cargar metas
      document.getElementById('test-load-goals').addEventListener('click', function() {
        loadGoalsList();
        showNotification('Lista de metas actualizada', 'success');
      });
      
      // Cargar metas al inicio
      loadGoalsList();
    });
  </script>
</body>
</html> 